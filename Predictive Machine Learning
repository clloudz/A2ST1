import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split

df = pd.read_csv('wwc_matches.csv')

outcome_data = df.copy()
le = LabelEncoder()
for col in df.columns:
    if df[col].dtype == 'object':
        outcome_data[col] = le.fit_transform(df[col])

team_le = LabelEncoder()
team_le.fit(pd.concat([df["team1"], df["team2"]]).unique())

outcome_data["outcome"] = np.where(df["score1"] > df["score2"], 0, 1)

features = ['team1', 'team2']

x = outcome_data[features]
y = outcome_data['outcome']

x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.2, random_state=42)

best_model = RandomForestClassifier()
best_model.fit(x_train, y_train)
y_pred = best_model.predict(x_test)
model_accuracy = accuracy_score(y_test, y_pred)


def predict_winner(team1, team2):
    team1_encoded = team_le.transform([team1])
    team2_encoded = team_le.transform([team2])

    # Create a dataframe with the same structure as the training data
    input_data = pd.DataFrame({'team1': [team1_encoded[0]], 'team2': [team2_encoded[0]]})

    prediction = best_model.predict(input_data)
    return 'Team 1' if prediction == 0 else 'Team 2'
